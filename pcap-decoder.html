<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PCAP Decoder</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .container {
            width: 60%;
            margin: 0 auto;
            text-align: center;
        }
        .file-upload {
            margin-top: 20px;
        }
        .file-info {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>PCAP File Decoder</h1>
        <input type="file" id="fileInput" class="file-upload" accept=".pcap,.cap" />
        <div id="fileInfo" class="file-info"></div>
    </div>

    <script>
        document.getElementById('fileInput').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (!file) {
                alert('No file selected!');
                return;
            }
            const reader = new FileReader();
            reader.onload = function(e) {
                const buffer = e.target.result;
                parsePCAP(buffer);
            };
            reader.readAsArrayBuffer(file);
        });

        function parsePCAP(buffer) {
            const view = new DataView(buffer);
            
            // PCAP Global Header (24 bytes)
            const magicNumber = view.getUint32(0, true);
            const versionMajor = view.getUint16(4, true);
            const versionMinor = view.getUint16(6, true);
            
            // Skipping to first packet (PCAP packet header is 16 bytes long)
            const packetOffset = 24 + 16;

            // Ethernet header: typically 14 bytes
            const ethernetHeaderLength = 14;

            // IP header: Check the IP header length (contained in lower nibble of the first byte after Ethernet header)
            const ipHeaderOffset = packetOffset + ethernetHeaderLength;
            const ipHeaderLength = (view.getUint8(ipHeaderOffset) & 0x0F) * 4;

            // TCP header: Check the TCP header length (contained in the first nibble of the 13th byte after IP header)
            const tcpHeaderOffset = ipHeaderOffset + ipHeaderLength;
            const tcpHeaderLength = (view.getUint8(tcpHeaderOffset + 12) >> 4) * 4;

            // Calculating the start of the payload (Ethernet + IP + TCP headers)
            const payloadOffset = tcpHeaderOffset + tcpHeaderLength;

            // Extract the payload (from payloadOffset to the end of the buffer)
            let rawData = '';
            for (let i = payloadOffset; i < buffer.byteLength; i++) {
                rawData += String.fromCharCode(view.getUint8(i));
            }

            // Display basic info + payload
            const info = `
                <h2>PCAP File Info</h2>
                Magic Number: ${magicNumber.toString(16)}<br>
                Version: ${versionMajor}.${versionMinor}<br>
                <h2>Extracted Payload</h2>
                <p>${rawData}</p>
            `;
            document.getElementById('fileInfo').innerHTML = info;
        }
    </script>
</body>
</html>
